[TOC]

# 设计模式

设计模式对以往代码设计经验的总结，是编写代码的最佳实战。

设计模式的思考出发点是大型软件开发，是为了便于维护、升级软件，其核心就是要降低耦合，提高复用。

## 1. GOF

Gang of Four，指的是四位首次提出设计模式的作者。在 1994 年，由 Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides 四人合著出版了一本名为 Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素） 的书，该书首次提到了软件开发中设计模式的概念。

## 2. 设计模式的类型

《设计模式》那本书中总共提到了23种设计模式，这些设计模式可以分为三类：创建型模式、结构型模式、行为型模式。

### 2.1 创建型模式

关注如何创建对象的设计模式。

- 工厂模式
- 抽象工厂模式
- 单利模式
- 建造者模式
- 原型模式

### 2.2 结构型模式

关注类和对象如何组合的模式。

- 适配器模式
- 桥接模式
- 过滤器模式
- 组合模式
- 装饰器模式
- 外观模式
- 享元模式
- 代理模式

### 2.3 行为型模式

关注对象之间交互通信的模式。

- 责任链模式
- 命令模式
- 解释器模式
- 迭代器模式
- 中介者模式
- 备忘录模式
- 观察者模式
- 状态模式
- 空对象模式
- 策略模式
- 模板模式
- 访问者模式

## 3. 设计模式的六大原则

### 3.1 开闭原则

**对扩展开放，对修改关闭。**

开闭原则是由Bertrand Meyer于1988年提出，定义为：一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。

为了满足开闭原则，需要对系统进行抽象化设计，抽象化是开闭原则的关键。在Java、C#等编程语言中，可以**为系统定义一个相对稳定的抽象层，而将不同的实现行为移至具体的实现层中完成**。在很多面向对象编程语言中都提供了接口、抽象类等机制，可以通过它们定义系统的抽象层，再通过具体类来进行扩展。如果需要修改系统的行为，无须对抽象层进行任何改动，只需要增加新的具体类来实现新的业务功能即可，实现在不修改已有代码的基础上扩展系统的功能，达到开闭原则的要求。

**编程时的做法：**
如果要扩展程序的功能，那么不要直接去修改代码，而是要通过接口或抽象类实现。

开闭原则算是编程层面的目标。

### 3.2 里氏代换原则

里氏代换原则由2008年图灵奖得主、美国第一位计算机科学女博士Barbara Liskov教授和卡内基·梅隆大学Jeannette Wing教授于1994年提出。

里氏代换原则的通俗定义：**引用基类的地方，可以透明地使用子类**。

这个原则约束了子类和基类之间必须要满足的条件，保证子类是基类的完全继承。里氏原则其实已经融入到了语言的语法层面，借助语言提供的功能，我们很容易遵守这个原则。我们继承一个类，那么必然拥有了这个类的可以被外部调用的方法，如果继承的是抽象类或者接口，那么必然会实现其中的方法。

里氏原则是实现“开闭原则”的主要保证，只有代码层面满足了里氏原则，才可以帮助实现开闭原则，才能通过扩展的方式实现功能的增加。

### 3.3 依赖倒转原则

开闭原则的基础。**针对接口编程，依赖抽象而不依赖具体**。

是由Robert C. Martin在1996年为“C++ Reporter”所写的专栏Engineering Notebook的第三篇文章中提到的。

**依赖倒转原则的定义**：抽象不应依赖于细节，细节应依赖于抽象。通俗点，应该面向接口、抽象类编程，而不是具体实现类。

**编程时的具体体现**：
在声明方法参数类型、变量声明、方法返回类型、数据类型转换等位置，都应该使用接口或抽象类。

在上面所说的位置上用接口或抽象类声明了参数，那么依赖如何注入呢？比如一个类，它内部变量使用了接口，或者它的方法的参数用了接口。依赖注入有三种方式：构造函数注入、setter方法注入、接口注入。接口注入其实就是通过方法传参数来注入，之所以叫接口注入，是因为一个类的方法都是通过实现某个接口获取的。

面向接口、抽象编程，让对象之间交互的方式都是使用接口，这样的代码会更稳定，只要新的类型实现了这个接口，就能稳定的运行在这部门代码中(里式替换原则)。整个代码的处理逻辑都是依赖于抽象层，不会依赖于具体的类，通过抽象层完成整个业务模型的构建，到具体运行时，在传入具体的类。**抽象层编写代码就是一个建模的过程**，具体类就是模型的运行输入。

面向接口编程，要求一个类只提供接口中的方法，不会提供其他方法，纵使提供了，也是无法调用的。

### 3.4 接口隔离原则

接口的设计**不要大而全**，应该是**小而专**。

先来谈谈**接口的含义**：

对于了解面向对象的编程语言的人，提到接口，很容易想到的是语言层面提供的“接口”，这只是狭义的接口，是语言层面提供的预设关于接口的工具。

接口的本质含义就是对外提供的功能，比如类型对外提供的函数，就是这个类型对外的接口。

接下来说说，对于不同的接口含义，这个原则是如何体现的：

1. 对于编程语言中的“接口”，那就是我们在定义接口类型时，接口约束的方法应该是集中于某个点，接口中的方法应该是集中的、紧密相关的，所谓紧密相关指的是一定需要同时存在的。如果不是紧密相关，那么就分拆到多个接口类型中。

2. 对于更抽象的接口含义，“小而专”就体现在要创建多个类型上，不同的类型提供方法要集中。这也是“单一职责原则”强调的点。

接口隔离，也要适度，不可过小，否则就会接口泛滥，代码反倒结构不清晰了。

### 3.5 迪米特法则，也叫最少知道原则

**一个实体应尽量少地与其他实体发生相互作用**。

迪米特法则来自于1987年美国东北大学(Northeastern University)一个名为“Demeter”的研究项目。迪米特法则又称为最少知识原则(LeastKnowledge Principle, LKP)。

迪米特法则是为了降低模块之间的耦合，这样当一个模块修改是，尽可能少的影响到其他尽可能少的代码。

但是，我们要明白一点，一个系统的不同模块之间必然存在耦合，无耦合就不成为一个统一的系统。所以，我们要用更为合理的方式来解决模块之间的耦合，减少不必要的耦合。

具体的建议：

1. **中心化**，避免不同模块之间直接的交互，通过中间代理模块，减少耦合。
2. 设计类时，也要尽可能少引用其他的类；不该暴露的功能和成员变量，就设置为私有。

### 3.6 单一职责原则

一个类的角色定位要集中，只应该具备与类设定的角色有关的功能。定位清晰，干活专一。过多的责任，就会造成过多的耦合，不利于代码的复用。

## 4. 六大原则之间关系

单一职责原则、开闭原则、里式替换原则、依赖倒置原则、接口分离原则、迪米特法则，这六个原则共同构成了对代码设计点到面的指导。

**开闭原则**是为了实现低耦合的一个总目标，让代码能够不修改，只是通过扩展来完成需求的变更。为了达到这个目标，我们需要一些更为细的指导原则。

## 参考

1. [设计模式菜鸟教程](https://www.runoob.com/design-pattern/design-pattern-tutorial.html)
2. [设计模式六大原则](https://blog.csdn.net/fragmentalice/article/details/82460939)