[TOC]

# Spring MVC请求参数获取方式

## 1. Get方法获取参数

Get请求是没有Body的，所以参数都是从URL中解析出来。

有以下几种：

- 直接方法参数获取
- @RequestParam方式
- Bean方式获取
- @PathVariable方式
- HttpServletRequest方式
- @ModelAttribute

### 1.1 直接方法参数

```java
@RequestMapping(path = "/req2")
public String req2(String user, String password) {
    return "req2 user: " + user + " pwd: " + password;
}
```

```txt
http://127.0.0.1:8080/req2?user=%E5%B0%8F%E7%81%B0%E7%81%B0Blog&password=123456
## 输出： req2 user: 小灰灰Blog pwd: 123456

http://127.0.0.1:8080/req2?password=123456
## 输出： req2 user: null pwd: 123456


http://127.0.0.1:8080/req2?password=123456&User=blog
## 输出： req2 user: null pwd: 123456
```

注意事项：

- 上面这种使用方式，相当于直接将url参数映射到了Controller方法的参数上了
- 方法参数名必须和url参数名完全一致（区分大小写）
- 顺序无关
- 若参数没传，则默认为null

对上面的代码稍作修改，测试int类型的参数：

```java
@RequestMapping(path = "/req2")
public String req2(String user, int password) {
    return "req2 user: " + user + " pwd: " + password;
}
```

```txt
# case1 
http://127.0.0.1:8080/req2?password=123456&user=blog
## 输出： req2 user: blog pwd: 123456


# case 2
http://127.0.0.1:8080/req2?password2=123456&user=blog
## 输出: 报错, Optional int parameter 'password' is present but cannot be translated into a null value due to being declared as a primitive type. Consider declaring it as object wrapper for the corresponding primitive type


# case 3
http://127.0.0.1:8080/req2?password=abc&user=blog
## 输出：报错, "Failed to convert value of type 'java.lang.String' to required type 'int'; nested exception is java.lang.NumberFormatException: For input string: "abc""
```

- 如果请求参数与方法参数类型不一致，会抛出转换异常
- 如果方法参数为非封装基本类型，也就是不可以为null类型的参数必须存在，则url参数必须存在，否则报错

### 1.2 @RequestParam

```java
@RequestMapping(path = "req3", method = RequestMethod.GET)
public String req3(@RequestParam("user") String username,
                   @RequestParam("password") String pwd) {
    return "req3 user: " + username + " pwd: " + pwd;
}
```

这中方式和1.1的方式类似，不过引入了下面个属性来控制参数的行为：

- name或value属性，指定url中参数名称。这样可以使函数参数和url参数不一样；
- required属性，如果为false，那么这个参数就可以不用传入url中。
- defaultValue属性，指定默认值。

### 1.3 Bean方式

```java
@Data //这个注解的作用是省掉了setter和getter方法
public static class UserDO {
    String user;
    String password;
}

@RequestMapping(path = "req4", method = RequestMethod.GET)
public String req4(UserDO userDO) {
    return "req4 userDO: " + userDO;
}
```

```txt
# case1
http://127.0.0.1:8080/webs/demo/req4?password=123456&user=%E5%B0%8F%E7%81%B0%E7%81%B0Blog
## 输出: req4 userDO: DemoController.UserDO(user=小灰灰Blog, password=123456)


# case2
http://127.0.0.1:8080/webs/demo/req4?password=123456
## 输出: req4 userDO: DemoController.UserDO(user=null, password=123456)
```

- 定义一个bean，内部属性和请求参数对应
- 允许参数不存在的情况，会使用null代替（所以，尽量不要使用非封装基本类型，否则参数不传时，会抛异常）
- bean的属性，可以根据实际情况指定类型

### 1.4 @PathVariable

其他的方法都是获取url中真正意义上的参数，而@PathVariable则是为了获取路径中的信息。

比如：http://127.0.0.1:8080/webs/demo/req4?password=123456，其中password是我们传统意义上的请求参数，其中path参数则是指其中 req4, demo这种path路径中的信息。

```java
@RequestMapping(path = "req6/{user}/info")
public String req6(@PathVariable(name = "user") String user) {
    return "req6 user: " + user;
}
```

```txt
# case1
http://127.0.0.1:8080/webs/demo/req6/blog/info?user=haha
## 输出：req6 user: blog

# case2
http://127.0.0.1:8080/webs/demo/req6/blog?user=haha
## 输出: 404

# case3
http://127.0.0.1:8080/webs/demo/req6/info?user=haha
## 输出: 404
```

**注意：**

- path参数的使用，需要确保参数存在且类型匹配
- path参数和url参数不会相互影响

### 1.5 HttpServletRequest

这个可以说是最基本最常见的的方式了，javax.servlet.ServletRequest#getParameter 来获取对应的参数。

```java
@RestController
@RequestMapping(path = "webs/demo")
public class DemoController {

    @RequestMapping(path = "req1")
    public String req1(HttpServletRequest request) {
        String user = request.getParameter("user");
        String password = request.getParameter("password");
        return "req1 user: " + user + " pwd: " + password;
    }
}
```

```txt
http://127.0.0.1:8080/webs/demo/req1?user=小灰灰Blog&password=123456
## 输出  req1 user: 小灰灰Blog pwd: 123456

http://127.0.0.1:8080/webs/demo/req1?user=小灰灰Blog
## 输出  req1 user: 小灰灰Blog pwd: null
```

- 这是一个最基本的获取参数的方式，get，post请求都适用的，通常在filter,intercepter中也是可以通过HttpServletRequest对象来获取请求参数
- 除了获取常见的请求参数之外，HttpServletRequest可以获取请求头的完整信息
- 在一次请求的生命周期内，可以通过下面的方式获取Request对象(当然也可以获取response对象):
  HttpServletRequest httpServletRequest = ((ServletRequestAttributes)
    RequestContextHolder.getRequestAttributes()).getRequest();

### 1.6 @ModelAttribute方式

@ModelAttribute注解的方法，会优于Controller之前执行，一般更常见于向视图传输数据使用，此处不详细展开，正常来讲，专门的获取参数不太会用这这种方式来玩。

## 2. Post方法获取参数

除了上面的方式，还有：

- @RequestBody

Post请求可以发送Body，有两种比较特殊：@RequestBody和HttpServletRequest两种方式，@RequestBody主要用于处理Json格式的Body数据，而HttpServletRequest则可以处理任意内容。

其他的接受参数的方法可以处理：content-type:application/x-www-form-urlencoded也就是Body内容格式为key1=value1&key2=value2...的请求，这种格式和URL中传入参数的格式是一致的。

## 参考

1. [SpringMVC之请求参数的获取方式](https://blog.hhui.top/hexblog/2018/01/04/SpringMVC%E4%B9%8B%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F)
